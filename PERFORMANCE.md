# Руководство по оптимизации производительности

В этом документе описаны инструменты и методы для оптимизации производительности сайта myStylus и проверки скорости загрузки.

## Ключевые метрики производительности

Мы стремимся достичь следующих значений Core Web Vitals:

- **LCP (Largest Contentful Paint)**: < 2.5 секунды
- **FID (First Input Delay)**: < 100 мс
- **CLS (Cumulative Layout Shift)**: < 0.1
- **TTFB (Time to First Byte)**: < 800 мс

## Доступные скрипты оптимизации

В проекте настроены следующие npm-скрипты для оптимизации и проверки производительности:

### Оптимизация

```bash
# Оптимизировать изображения (создает WebP и AVIF версии)
npm run optimize:images

# Запустить все оптимизации и проанализировать размер бандла
npm run optimize:all

# Собрать проект с оптимизациями и запустить предпросмотр
npm run serve:optimized

# Запустить полный процесс пред-деплойной оптимизации
npm run pre-deploy
```

### Тестирование скорости

```bash
# Запустить базовый Lighthouse тест
npm run lighthouse

# Запустить комплексное тестирование скорости 
# (мобильные и десктопные устройства, медленные соединения)
npm run speed-test

# Проверить скорость производственной версии
npm run speed-test:prod
```

## Используемые оптимизации

В проекте реализованы следующие оптимизации:

### 1. Оптимизация изображений

- Автоматическое создание WebP и AVIF форматов для всех изображений
- Создание различных размеров для адаптивной загрузки (responsive images)
- Использование компонента `OptimizedImage` с правильными атрибутами `srcset` и `sizes`
- Приоритизация загрузки LCP изображений (`fetchpriority="high"`, `loading="eager"`)

### 2. Оптимизация JavaScript

- Разделение кода (code splitting) на основе маршрутов и библиотек
- Асинхронная загрузка некритичных ресурсов
- Ленивая загрузка компонентов ниже линии видимости
- Прогрессивный гидратация для более быстрой интерактивности

### 3. Оптимизация CSS

- Критический CSS внедряется в HTML для быстрого рендеринга
- Предзагрузка шрифтов и использование display:swap
- CSS код разделяется для ускорения загрузки основного контента
- Оптимизация под разные устройства и соединения

### 4. Сервис-воркер

- Кэширование статических ресурсов
- Стратегия stale-while-revalidate для JS и CSS
- Сетевые стратегии для API запросов
- Offine-поддержка

### 5. Оптимизации Core Web Vitals

- Предотвращение смещения макета (CLS)
- Оптимизация путей критического рендеринга (LCP)
- Снижение времени блокировки основного потока (FID/TBT)
- Быстрое время до первого байта (TTFB)

## Рекомендации по разработке

1. **Изображения**:
   - Всегда используйте компонент `OptimizedImage` вместо обычного `<img>`
   - Для LCP изображений используйте `priority={true}`
   - Указывайте размеры изображений (`width` и `height`)

2. **JavaScript**:
   - Используйте динамический импорт для некритичных компонентов
   - Минимизируйте JavaScript в первоначальной загрузке
   - Избегайте тяжелых вычислений в основном потоке

3. **CSS**:
   - Используйте классы для условной загрузки анимаций
   - Следите за размером стилей в критическом пути
   - Используйте content-visibility для оптимизации рендеринга

4. **Сборка**:
   - Перед деплоем всегда запускайте `npm run pre-deploy`
   - Проверяйте размер бандла с помощью `npm run build:analyze`
   - Тестируйте на медленных устройствах и соединениях

## Интерпретация результатов тестирования

После запуска `npm run speed-test` вы получите отчеты в директории `performance-reports/`:

- **Lighthouse отчеты**: детальный анализ производительности
- **Web Vitals отчет**: измерения реальных метрик пользователей
- **Сводный отчет**: общее резюме тестов и рекомендации

Если какие-либо метрики не соответствуют целевым значениям, используйте рекомендации из отчетов для выявления и устранения проблем.

## Полезные ресурсы

- [Web Vitals от Google](https://web.dev/vitals/)
- [Оптимизация LCP](https://web.dev/optimize-lcp/)
- [Оптимизация CLS](https://web.dev/optimize-cls/)
- [Оптимизация FID](https://web.dev/optimize-fid/)
- [Оптимизация изображений](https://web.dev/fast/#optimize-your-images)

---

Это руководство будет обновляться по мере развития проекта и добавления новых оптимизаций. 